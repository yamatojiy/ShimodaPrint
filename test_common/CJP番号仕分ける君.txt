*■*****************************************************************************
*■*****************　　　　　  表の指定項目に外字があるかチェックする。
*■*****************　　　　１.全部見る。
*■*****************　　　　２.あればテキストで吐き出す
*■*****************　　　　３.終わりを告げる
*■*****************************************************************************
var 数値  { &現在表番号 }
var 数値  { &配列数 = 11 }
var 数値  { &件数配列 = &配列数 + 1 }
var 数値  { &面付 = 24 }
var 数値  { &各カウント[&件数配列] = { 0 } }
var 数値  { &面付カウント[&件数配列] = { 0 } }

var 数値  { &検索結果　, &検索住所1 , &検索住所2 , &CHK , &gaiCount = 0 , &i = 1 }
var 文字列{ &出力日 , &ログ名称 , &番号CHK[&配列数] }

var 文字列{ &九州外 = "九州外"}

/*▼ファイルパス　*/
var 文字列{ &年度別件数tbx = #一括パス名　+ "【JP】年度別件数.tbx" }

/*▼配列代入作業　*/
&番号CHK[1] = &九州外
&番号CHK[2] = "80"
&番号CHK[3] = "81"
&番号CHK[4] = "82"
&番号CHK[5] = "83"
&番号CHK[6] = "84"
&番号CHK[7] = "85"
&番号CHK[8] = "86"
&番号CHK[9] = "87"
&番号CHK[10] = "88"
＊&番号CHK[11] = "89"



var 文字列{ &検索文字2 }　/*←テストデータです */

var 文字列{ &検索文字 }

*■*::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
*■*:::　マスターデータ作業用
var 文字列{ &IniFile = #一括パス名 +　"master.ini" }
var 文字列{ &Mastertbx = #一括パス名 +"_master\master.tbx" }
var 文字列{ &MainFileName , &SubFileName }


*■***********************************************************
*■******  　処理
*■***********************************************************

/*▼編集表の表番号を格納　*/
&現在表番号 = #IS表


/*▼変数格納　*/
手続き実行　table整理（）

/*▼フォルダ作成　*/
var 文字列{ &Mainフォルダ作成Path = #一括パス名 + &SubFileName }
    フォルダ作成　&Mainフォルダ作成Path　, 終了状態 = &CHK

var 文字列{ &tbxPath = &Mainフォルダ作成Path +"\" }
var 文字列{ &OutTbxPath = &tbxPath + &番号CHK[1] }

*■*:::　メイン処理   :::::::::::::::::::::::::::::::::::::::::::

編集表　&現在表番号

並べ替え　 { [〒番号] 昇順 }

繰り返し（ &i < 12 ）

    &検索文字 = &番号CHK[&i]
    &OutTbxPath = &tbxPath + &番号CHK[&i]

    if (&検索文字 <> &九州外　)

        絞り込み [〒番号] { &検索文字 * } ,  終了状態　= &CHK
        書き出し　表　, &OutTbxPath , 終了状態 = &CHK 

    else
        /*▼九州外の時の集計はこっち　*/
        絞り込み [〒番号] { "8" } ,部分一致検索 = 先頭一致,  終了状態　= &CHK
        絞り込み 補集合
        書き出し　表　, &OutTbxPath , 終了状態 = &CHK 

    end
    
    /*▼件数情報をカウント　*/
    &各カウント[&i] = #総件数
    &各カウント[&件数配列] = &各カウント[&件数配列] + &各カウント[&i]


    &面付カウント[&i] = #切り上げ( &各カウント[&i] / &面付 , 0 )
    &面付カウント[&件数配列] = &面付カウント[&件数配列] + &面付カウント[&i]

    解除 1
    
    &i = &i +1
繰り返し終了

解除 1

*■*::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
*■*:  各件数をまとめて表示する
var 数値  { &v = 1 }

編集表　16

    繰り返し（ .NOT #終端行 ）

        コマンド　" 行訂正 終了状態 = &CHK , ["+ &MainFileName +"] = "+ #文字列( &各カウント[&v] ) +" , [タック枚数] = " + #文字列(&面付カウント[&v])
        ジャンプ 行番号 = 次行
        &v = &v +1

    繰り返し終了 

終了　表　16

/*▼整える　*/
ジャンプ 行番号 = 1

確認 "作業が完了しました。総数は【JP】年度別件数.tbxに記載しています。"
*■*----------------------------------------------------------
*■*-----　　Iniファイルからtableデータを作る
*■*----------------------------------------------------------
手続き定義開始 table整理()

    表　&Mastertbx , 表番号 = 15 , モード = 共有更新

    読み込み　テキスト , &IniFile
    ジャンプ　行番号　= 最終

    &MainFileName = [Main]
    &SubFileName  = [Sub]
    
    終了　表　15

    *■*::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

    表　　&年度別件数tbx  , 表番号 = 16 , モード = 専有
        var 文字列  { &str1 }

        if ( #項目番号( &MainFileName ) = "" )
            項目属性変更２ 挿入 , [タック枚数] , { &MainFileName , "数値" } 

            &str1 = "年度別件数tbx　に　『 "+ &MainFileName +" 』 の項目を登録しました。"
            確認　&str1
        end
    
手続き定義終了

